<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Book Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body style="background:#ececec;">

<div class="container mt-4 p-4 bg-white rounded shadow-sm">

    <form th:action="@{/books/new}" th:object="${book}"
          method="post" enctype="multipart/form-data">

        <input type="hidden" th:if="${book.id != null}" th:field="*{id}"/>

        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3 th:text="${book.id != null ? 'Edit Book' : 'Create Book'}"></h3>
            </div>

            <div class="card-body">

                <div class="mb-3">
                    <label class="form-label fw-bold">Code</label>
                    <input type="text" th:field="*{code}" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Name</label>
                    <input type="text" th:field="*{name}" class="form-control" required>
                </div>

                <!-- IMAGE UPLOAD -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Image</label>

                    <input type="file" name="imageBook"
                           class="form-control" accept="image/*"
                           onchange="previewImage(event)">

                    <input type="hidden" th:field="*{imgUrl}">

                    <div class="mt-3">
                        <img id="previewOld" th:if="${book.imgUrl != null}"
                             th:src="@{${book.imgUrl}}"
                             style="width:150px;height:150px;object-fit:cover;border:1px solid #ccc;">

                        <img id="previewNew"
                             style="width:150px;height:150px;object-fit:cover;border:1px solid #ccc;display:none;">
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Description</label>
                    <textarea th:field="*{description}" class="form-control" rows="3"></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Quantity</label>
                    <input type="number" th:field="*{quantity}" class="form-control" min="0">
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Price</label>
                    <input type="number" th:field="*{price}" class="form-control" step="0.01">
                </div>

                <!-- AUTHORS -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Authors</label>

                    <div class="d-flex flex-wrap">
                        <div th:each="a : ${authors}" class="form-check me-3">
                            <input type="checkbox" class="form-check-input"
                                   name="authorIds" th:value="${a.id}"
                                   th:checked="${book.authors.contains(a)}">
                            <label class="form-check-label" th:text="${a.name}"></label>
                        </div>
                    </div>
                </div>

            </div>

            <div class="card-footer text-end">
                <button type="submit" class="btn btn-success"
                        th:text="${book.id != null ? 'Update' : 'Create'}"></button>
                <a th:href="@{/books}" class="btn btn-secondary">Back</a>
            </div>
        </div>

    </form>

</div>

<script>
    function previewImage(event) {
        let file = event.target.files[0];
        let previewOld = document.getElementById('previewOld');
        let previewNew = document.getElementById('previewNew');

        if (previewOld) previewOld.style.display = "none";

        previewNew.style.display = "block";
        previewNew.src = URL.createObjectURL(file);
    }
</script>

</body>
</html>

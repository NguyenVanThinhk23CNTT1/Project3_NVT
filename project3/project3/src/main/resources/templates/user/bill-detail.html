<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Ph√≤ngt·ªët - Thanh to√°n h√≥a ƒë∆°n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root{
          --brand:#22c7c7; --brand-2:#0ea5a5; --brand-dark:#0b5564;
          --ink:#0f172a; --muted:#64748b; --radius:18px;
        }
        .pt-header{ position: sticky; top:0; z-index:1030; background:#fff; border-bottom:1px solid rgba(15,23,42,.08); }
        .pt-container{ max-width: 1200px; }
        .brand{ display:flex; gap:10px; align-items:center; text-decoration:none; color:var(--ink); }
        .brand .logo{ width:38px; height:38px; border-radius:12px; background: linear-gradient(135deg, var(--brand), var(--brand-dark));
          display:flex; align-items:center; justify-content:center; box-shadow:0 .5rem 1rem rgba(34,199,199,.25); overflow:hidden; }
        .brand .name{ font-weight:900; font-size:1.05rem; line-height:1.05; }
        .brand .sub{ font-size:.82rem; color:var(--muted); margin-top:-2px; }
        .nav-pill{ border-radius:999px; padding:.45rem .85rem; border:1px solid rgba(15,23,42,.12); background:#fff; color:var(--ink);
          transition: all .15s ease; text-decoration:none; font-size:.9rem; display:inline-flex; align-items:center; gap:8px; }
        .nav-pill.primary{ background: linear-gradient(135deg, var(--brand), var(--brand-2)); border:none; color:#fff; }
        .cardX{ border-radius: var(--radius); }
        .money{ font-weight:900; font-size:1.6rem; }
        .pay-tile{ border:1px solid rgba(15,23,42,.10); border-radius: 14px; padding: 14px; background:#fff; }
        .bank-box{ border:1px dashed rgba(15,23,42,.25); border-radius:12px; padding:12px; background:#fbfbfd; }

        /* ‚úÖ QR ‚Äútight‚Äù ph√≥ng to, kh√¥ng n·ªÅn */
        .qr-wrap{
          border:1px dashed rgba(15,23,42,.18);
          border-radius:12px;
          background:#fff;
          padding:10px;
          display:flex;
          justify-content:center;
          align-items:center;
          margin-top:10px;
        }
        .qr-img{
          width:100%;
          max-width:320px;   /* tƒÉng/gi·∫£m tu·ª≥ b·∫°n */
          height:auto;
          image-rendering: pixelated; /* nh√¨n QR n√©t h∆°n */
        }
    </style>
</head>

<body class="bg-light">

<header class="pt-header">
    <div class="container pt-container py-3 d-flex align-items-center justify-content-between gap-3 flex-wrap">
        <a class="brand" href="/">
            <div class="logo">
                <img th:src="@{/Svghome.png}" alt="Logo" style="width:100%;height:100%;object-fit:cover;">
            </div>
            <div>
                <div class="name">Ph√≤ngt·ªët</div>
                <div class="sub">Thanh to√°n h√≥a ƒë∆°n</div>
            </div>
        </a>

        <div class="d-flex align-items-center gap-2 flex-wrap">
            <a class="nav-pill" href="/">üè† Trang ch·ªß</a>
            <a class="nav-pill" href="/bills">üßæ Tra h√≥a ƒë∆°n</a>
            <a class="nav-pill" href="/feedback">üõ†Ô∏è Ph·∫£n √°nh</a>
            <span class="nav-pill primary">üí≥ Thanh to√°n</span>
        </div>
    </div>
</header>

<div class="container py-4" style="max-width: 980px">

    <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>
    <div th:if="${err}" class="alert alert-danger" th:text="${err}"></div>

    <div class="d-flex justify-content-between align-items-end flex-wrap gap-2 mb-3">
        <div>
            <h4 class="mb-1">H√≥a ƒë∆°n <span th:text="${bill.billMonth + '/' + bill.billYear}"></span></h4>
            <div class="text-muted">Ph√≤ng ID: <b th:text="${bill.roomId}"></b> ‚Ä¢ Tr·∫°ng th√°i: <b th:text="${bill.status}"></b></div>
        </div>
        <a class="btn btn-outline-secondary btn-sm" th:href="@{'/bills?roomId=' + ${bill.roomId}}">‚Üê Quay l·∫°i danh s√°ch</a>
    </div>

    <div class="row g-3">
        <!-- LEFT -->
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm cardX">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="text-muted">T·ªïng c·∫ßn thanh to√°n</div>
                            <div class="money" th:text="${bill.totalAmount}">0</div>
                        </div>
                        <div>
                            <span class="badge bg-warning text-dark" th:if="${bill.status.name()=='UNPAID'}">UNPAID</span>
                            <span class="badge bg-success" th:if="${bill.status.name()=='PAID'}">PAID</span>
                            <span class="badge bg-danger" th:if="${bill.status.name()=='OVERDUE'}">OVERDUE</span>
                        </div>
                    </div>

                    <hr>

                    <div class="row small g-2">
                        <div class="col-6"><b>Ti·ªÅn ph√≤ng:</b> <span th:text="${bill.rentAmount}"></span></div>
                        <div class="col-6"><b>Ti·ªÅn ƒëi·ªán:</b> <span th:text="${bill.electricAmount}"></span></div>
                        <div class="col-6"><b>Ti·ªÅn n∆∞·ªõc:</b> <span th:text="${bill.waterAmount}"></span></div>
                        <div class="col-6"><b>D·ªãch v·ª•:</b> <span th:text="${bill.serviceAmount}"></span></div>
                        <div class="col-6"><b>Gi·∫£m gi√°:</b> <span th:text="${bill.discount}"></span></div>
                        <div class="col-6" th:if="${bill.dueDate != null}"><b>H·∫°n:</b> <span th:text="${bill.dueDate}"></span></div>
                    </div>

                    <hr>

                    <h6 class="mb-2">L·ªãch s·ª≠ thanh to√°n</h6>
                    <div class="table-responsive">
                        <table class="table table-sm align-middle mb-0">
                            <thead>
                            <tr>
                                <th>Th·ªùi gian</th>
                                <th>Ph∆∞∆°ng th·ª©c</th>
                                <th>S·ªë ti·ªÅn</th>
                                <th>Tr·∫°ng th√°i</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="p : ${payments}">
                                <td th:text="${p.paidAt}"></td>
                                <td th:text="${p.method}"></td>
                                <td th:text="${p.amount}"></td>
                                <td th:text="${p.status}"></td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(payments)}">
                                <td colspan="4" class="text-center text-muted">Ch∆∞a c√≥ thanh to√°n n√†o</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="text-muted small mt-2">
                        Ghi ch√∫: Email s·∫Ω ƒë∆∞·ª£c g·ª≠i khi Admin x√°c nh·∫≠n thanh to√°n th√†nh c√¥ng (SUCCESS).
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT -->
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm cardX">
                <div class="card-body">
                    <h6 class="mb-2">Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n</h6>

                    <!-- ‚úÖ 1) ZALOPAY (ƒë·∫ßu ti√™n theo y√™u c·∫ßu) -->
                    <div class="pay-tile mb-3">
                        <div class="fw-semibold">üíô ZaloPay</div>
                        <div class="text-muted small mb-2">
                            Qu√©t QR ƒë·ªÉ thanh to√°n, sau ƒë√≥ nh·∫≠p m√£ giao d·ªãch ƒë·ªÉ Admin ƒë·ªëi so√°t v√† x√°c nh·∫≠n.
                        </div>

                        <div class="qr-wrap">
                            <img class="qr-img" th:src="@{/payments/zalopay.jpg}" alt="ZaloPay QR">
                        </div>

                        <form class="mt-3" method="post" th:action="@{'/bills/' + ${bill.id} + '/pay-zalopay'}">
                            <div class="mb-2">
                                <label class="form-label small">Email nh·∫≠n th√¥ng b√°o *</label>
                                <input class="form-control" name="email" type="email" required placeholder="abc@gmail.com">
                            </div>

                            <div class="mb-2">
                                <label class="form-label small">M√£ giao d·ªãch ZaloPay *</label>
                                <input class="form-control" name="transactionCode" required placeholder="VD: ZPxxxx / REFxxxx">
                            </div>

                            <button class="btn btn-outline-primary w-100" th:disabled="${bill.status.name()=='PAID'}">
                                G·ª≠i y√™u c·∫ßu x√°c nh·∫≠n ZaloPay
                            </button>
                        </form>
                    </div>

                    <!-- ‚úÖ 2) MOMO -->
                    <div class="pay-tile mb-3">
                        <div class="fw-semibold">üì≤ MoMo</div>
                        <div class="text-muted small mb-2">
                            Qu√©t QR ƒë·ªÉ thanh to√°n, sau ƒë√≥ nh·∫≠p m√£ giao d·ªãch ƒë·ªÉ Admin ƒë·ªëi so√°t v√† x√°c nh·∫≠n.
                        </div>

                        <div class="qr-wrap">
                            <img class="qr-img" th:src="@{/payments/momo.jpg}" alt="MoMo QR">
                        </div>

                        <form class="mt-3" method="post" th:action="@{'/bills/' + ${bill.id} + '/pay-momo'}">
                            <div class="mb-2">
                                <label class="form-label small">Email nh·∫≠n th√¥ng b√°o *</label>
                                <input class="form-control" name="email" type="email" required placeholder="abc@gmail.com">
                            </div>

                            <div class="mb-2">
                                <label class="form-label small">M√£ giao d·ªãch MoMo *</label>
                                <input class="form-control" name="transactionCode" required placeholder="VD: 123456789 / M2Uxxxx">
                            </div>

                            <button class="btn btn-outline-primary w-100" th:disabled="${bill.status.name()=='PAID'}">
                                G·ª≠i y√™u c·∫ßu x√°c nh·∫≠n MoMo
                            </button>
                        </form>
                    </div>

                    <!-- ‚úÖ 3) NG√ÇN H√ÄNG (MB Bank, cu·ªëi theo y√™u c·∫ßu) -->
                    <div class="pay-tile mb-3">
                        <div class="fw-semibold">üè¶ Chuy·ªÉn kho·∫£n (MB Bank)</div>
                        <div class="text-muted small mb-2">
                            Qu√©t QR ƒë·ªÉ chuy·ªÉn kho·∫£n, sau ƒë√≥ nh·∫≠p m√£ giao d·ªãch ƒë·ªÉ Admin ƒë·ªëi so√°t v√† x√°c nh·∫≠n.
                        </div>

                        <div class="qr-wrap">
                            <img class="qr-img" th:src="@{/payments/mbbank.jpg}" alt="MB Bank QR">
                        </div>

                        <div class="bank-box small mt-3">
                            <div class="text-muted mt-1">
                                N·ªôi dung chuy·ªÉn kho·∫£n g·ª£i √Ω:
                                <b th:text="${'HD' + bill.id}">HD</b>
                                ho·∫∑c
                                <b th:text="${'PHONG' + bill.roomId}">PHONG</b>
                            </div>
                        </div>

                        <form class="mt-3" method="post" th:action="@{'/bills/' + ${bill.id} + '/pay-bank'}">
                            <div class="mb-2">
                                <label class="form-label small">Email nh·∫≠n th√¥ng b√°o *</label>
                                <input class="form-control" name="email" type="email" required placeholder="abc@gmail.com">
                            </div>

                            <div class="mb-2">
                                <label class="form-label small">M√£ giao d·ªãch / M√£ tham chi·∫øu *</label>
                                <input class="form-control" name="transactionCode" required placeholder="VD: FT2432xxxx / REFxxxx">
                            </div>

                            <button class="btn btn-outline-primary w-100" th:disabled="${bill.status.name()=='PAID'}">
                                G·ª≠i y√™u c·∫ßu x√°c nh·∫≠n chuy·ªÉn kho·∫£n
                            </button>
                        </form>
                    </div>

                    <!-- CASH -->
                    <div class="pay-tile">
                        <div class="fw-semibold">üíµ Ti·ªÅn m·∫∑t</div>
                        <div class="text-muted small">
                            B·∫°n g·ª≠i y√™u c·∫ßu. Admin x√°c nh·∫≠n ƒë√£ nh·∫≠n ti·ªÅn th√¨ h·ªá th·ªëng m·ªõi g·ª≠i email v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i.
                        </div>

                        <form class="mt-3" method="post" th:action="@{'/bills/' + ${bill.id} + '/pay-cash'}">
                            <div class="mb-2">
                                <label class="form-label small">Email nh·∫≠n th√¥ng b√°o *</label>
                                <input class="form-control" name="email" type="email" required placeholder="abc@gmail.com">
                            </div>

                            <button class="btn btn-primary w-100" th:disabled="${bill.status.name()=='PAID'}">
                                G·ª≠i y√™u c·∫ßu thanh to√°n ti·ªÅn m·∫∑t
                            </button>
                        </form>
                    </div>

                </div>
            </div>

            <div class="text-muted small mt-2">
                Ghi ch√∫: T·∫•t c·∫£ ph∆∞∆°ng th·ª©c ƒë·ªÅu <b>PENDING</b> cho t·ªõi khi Admin x√°c nh·∫≠n, l√∫c ƒë√≥ h·ªá th·ªëng s·∫Ω g·ª≠i email.
            </div>
        </div>
    </div>
</div>

</body>
</html>

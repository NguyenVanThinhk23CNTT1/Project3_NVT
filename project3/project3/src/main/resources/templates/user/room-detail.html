<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Ph√≤ngt·ªët - Chi ti·∫øt ph√≤ng</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        :root{
            --brand:#22c7c7;
            --brand-2:#0ea5a5;
            --brand-dark:#0b5564;
            --ink:#0f172a;
            --muted:#64748b;
            --radius:18px;
        }
        body{ color:var(--ink); }

        /* Header (ƒë·ªìng b·ªô home) */
        .pt-header{
            position: sticky;
            top: 0;
            z-index: 1030;
            background: #fff;
            border-bottom: 1px solid rgba(15,23,42,.08);
        }
        .pt-container{ max-width: 1200px; }
        .brand{
            display:flex; gap:10px; align-items:center;
            text-decoration:none; color:var(--ink);
        }
        .brand .logo{
            width: 38px; height: 38px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--brand), var(--brand-dark));
            display:flex; align-items:center; justify-content:center;
            box-shadow: 0 .5rem 1rem rgba(34,199,199,.25);
            flex: 0 0 auto;
            overflow:hidden;
        }
        .brand .name{
            font-weight: 900;
            letter-spacing: .2px;
            font-size: 1.05rem;
            line-height: 1.05;
        }
        .brand .sub{
            font-size: .82rem;
            color: var(--muted);
            margin-top: -2px;
        }
        .nav-pill{
            border-radius: 999px;
            padding: .45rem .85rem;
            border: 1px solid rgba(15,23,42,.12);
            background:#fff;
            color: var(--ink);
            transition: all .15s ease;
            text-decoration:none;
            font-size: .9rem;
            display:inline-flex;
            align-items:center;
            gap:8px;
        }
        .nav-pill:hover{
            transform: translateY(-1px);
            border-color: rgba(34,199,199,.55);
            box-shadow: 0 .75rem 1.5rem rgba(2,132,199,.08);
        }
        .nav-pill.primary{
            background: linear-gradient(135deg, var(--brand), var(--brand-2));
            border: none;
            color:#fff;
        }
        .nav-pill.primary:hover{
            filter: brightness(.98);
            box-shadow: 0 .9rem 2rem rgba(34,199,199,.25);
        }

        /* Hero */
        .hero{
            border-radius: var(--radius);
            overflow:hidden;
            position: relative;
            height: 280px;
            background: #f1f3f5;
        }
        .hero img{ width:100%; height:100%; object-fit:cover; display:block; }
        .hero .shade{
            position:absolute; inset:0;
            background: linear-gradient(to bottom, rgba(0,0,0,.08), rgba(0,0,0,.6));
        }
        .hero .info{
            position:absolute; left: 16px; right:16px; bottom: 14px;
            color:#fff;
            text-shadow: 0 2px 10px rgba(0,0,0,.35);
        }
        .hero .code{ font-size: 1.55rem; font-weight: 950; }
        .hero .name{ opacity:.95; }

        .cardX{ border-radius: var(--radius); }
        .kv{ display:flex; gap: 10px; flex-wrap: wrap; color:#6c757d; }
        .kv .item{
            background:#f8f9fa;
            border: 1px solid #eef0f2;
            border-radius: 999px;
            padding: .35rem .6rem;
            font-size: .9rem;
        }
        .price{ font-size: 1.55rem; font-weight: 950; }
        .btn-soft{ border-radius: 14px; font-weight: 800; }

        /* Chat widget */
        .chat-fab{ position: fixed; right: 18px; bottom: 18px; z-index: 1050; display:flex; flex-direction:column; gap:10px; }
        .chat-btn{
            width: 56px; height: 56px;
            border-radius: 999px;
            box-shadow: 0 .75rem 1.5rem rgba(0,0,0,.18);
            border:none;
            background: #0f172a;
            color:#fff;
            font-size: 20px;
        }
        .chat-btn:hover{ background:#111c33; }
        .chat-panel{
            position: fixed;
            right: 18px;
            bottom: 86px;
            width: min(360px, calc(100vw - 36px));
            border-radius: 18px;
            overflow: hidden;
            box-shadow: 0 1rem 2rem rgba(0,0,0,.18);
            display:none;
            z-index: 1050;
            background: #fff;
        }
        .chat-header{
            background: #0f172a;
            color: #fff;
            padding: 10px 12px;
            display:flex;
            align-items:center;
            justify-content: space-between;
        }
        .chat-body{
            padding: 12px;
            height: 320px;
            overflow:auto;
            background: #f8f9fa;
        }
        .chat-msg{
            max-width: 85%;
            padding: 8px 10px;
            border-radius: 14px;
            margin-bottom: 8px;
            font-size: .92rem;
            line-height: 1.35;
        }
        .chat-bot{ background: #fff; border: 1px solid #e9ecef; }
        .chat-user{ background: #0d6efd; color:#fff; margin-left:auto; }
        .chat-foot{
            padding: 10px;
            border-top: 1px solid #e9ecef;
            display:flex;
            gap: 8px;
            background: #fff;
        }
        .chat-foot input{ border-radius: 999px; }
    </style>
</head>
<body class="bg-light">

<header class="pt-header">
    <div class="container pt-container py-3 d-flex align-items-center justify-content-between gap-3 flex-wrap">
        <a class="brand" href="/">
            <div class="logo">
                <img th:src="@{/Svghome.png}" alt="Logo"
                     style="width:100%;height:100%;object-fit:cover;">
            </div>
            <div>
                <div class="name">Ph√≤ngt·ªët</div>
                <div class="sub">Xem ph√≤ng ‚Ä¢ G·ª≠i y√™u c·∫ßu nhanh</div>
            </div>
        </a>

        <div class="d-flex align-items-center gap-2 flex-wrap">
            <a class="nav-pill" href="/">üè† Trang ch·ªß</a>
            <a class="nav-pill" href="/bills">üßæ Tra h√≥a ƒë∆°n</a>
            <a class="nav-pill" href="/feedback">üõ†Ô∏è Ph·∫£n √°nh</a>
            <button class="nav-pill primary" type="button" id="chatOpenTop">ü§ñ H·ªó tr·ª£</button>
        </div>
    </div>
</header>

<div class="container py-4" style="max-width: 980px">
    <div th:if="${msg}" class="alert alert-success" th:text="${msg}"></div>
    <div th:if="${err}" class="alert alert-danger" th:text="${err}"></div>

    <!-- Hero ·∫£nh -->
    <div class="hero shadow-sm mb-3">
        <img th:if="${room.imageUrl != null}" th:src="${room.imageUrl}" alt="·∫¢nh ph√≤ng">
        <img th:if="${room.imageUrl == null}"
             src="https://images.unsplash.com/photo-1505693314120-0d443867891c?auto=format&fit=crop&w=1200&q=60"
             alt="·∫¢nh ph√≤ng">

        <div class="shade"></div>
        <div class="info">
            <div class="code" th:text="${room.roomCode != null ? room.roomCode : ('#' + room.id)}"></div>
            <div class="name" th:text="${room.roomName != null ? room.roomName : 'Ph√≤ng tr·ªç'}"></div>
            <div class="small mt-1">
                Tr·∫°ng th√°i:
                <span class="badge bg-success" th:if="${room.status != null && room.status.name()=='EMPTY'}">EMPTY</span>
                <span class="badge bg-secondary" th:if="${room.status != null && room.status.name()!='EMPTY'}" th:text="${room.status}"></span>
            </div>
        </div>
    </div>

    <div class="row g-3">
        <!-- Th√¥ng tin ph√≤ng -->
        <div class="col-lg-7">
            <div class="card border-0 shadow-sm cardX">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                        <div>
                            <div class="text-muted small">Gi√° thu√™ / th√°ng</div>
                            <div class="price">
                                <span th:text="${#numbers.formatDecimal(room.rentPrice, 0, 'COMMA', 0, 'POINT')}"></span>
                                <span class="text-muted" style="font-size:1rem">ƒë</span>
                            </div>
                            <div class="text-muted small" th:if="${room.depositDefault != null}">
                                Ti·ªÅn c·ªçc d·ª± ki·∫øn:
                                <b th:text="${#numbers.formatDecimal(room.depositDefault, 0, 'COMMA', 0, 'POINT')} + 'ƒë'"></b>
                            </div>
                        </div>
                        <div class="kv">
                            <div class="item">üè¢ T·∫ßng <b th:text="${room.floor != null ? room.floor : 1}"></b></div>
                            <div class="item">üë• <b th:text="${room.maxPeople != null ? room.maxPeople : 1}"></b> ng∆∞·ªùi</div>
                            <div class="item" th:if="${room.area != null}">üìê <b th:text="${room.area}"></b> m¬≤</div>
                        </div>
                    </div>

                    <hr class="my-3">

                    <div class="row g-2 small">
                        <div class="col-md-6"><b>M√£ ph√≤ng:</b> <span th:text="${room.roomCode}"></span></div>
                        <div class="col-md-6"><b>T√™n ph√≤ng:</b> <span th:text="${room.roomName}"></span></div>
                        <div class="col-md-6"><b>Hostel ID:</b> <span th:text="${room.hostelId}"></span></div>
                        <div class="col-md-6"><b>·∫¢nh:</b>
                            <span th:if="${room.imageUrl != null}" class="text-success">C√≥</span>
                            <span th:if="${room.imageUrl == null}" class="text-muted">Ch∆∞a c√≥</span>
                        </div>
                    </div>

                    <div class="mt-3">
                        <div class="fw-semibold mb-1">M√¥ t·∫£</div>
                        <div class="text-muted" th:text="${room.description != null ? room.description : 'Ch∆∞a c√≥ m√¥ t·∫£'}"></div>
                    </div>

                    <div class="alert alert-warning mt-3 mb-0 small">
                        Tip: N·∫øu b·∫°n th√≠ch ph√≤ng n√†y, c·ª© g·ª≠i y√™u c·∫ßu thu√™. Admin s·∫Ω duy·ªát v√† li√™n h·ªá x√°c nh·∫≠n l·ªãch xem ph√≤ng / k√Ω h·ª£p ƒë·ªìng.
                    </div>
                </div>
            </div>
        </div>

        <!-- Form g·ª≠i y√™u c·∫ßu thu√™ -->
        <div class="col-lg-5">
            <div class="card border-0 shadow-sm cardX">
                <div class="card-body">
                    <h6 class="mb-2">G·ª≠i y√™u c·∫ßu thu√™ ph√≤ng</h6>
                    <div class="text-muted small mb-3">ƒêi·ªÅn th√¥ng tin, admin s·∫Ω li√™n h·ªá s·ªõm.</div>

                    <form method="post" th:action="@{'/rooms/' + ${room.id} + '/book'}" class="row g-3">
                        <div class="col-12">
                            <label class="form-label">H·ªç t√™n *</label>
                            <input class="form-control" name="fullName" required placeholder="Nguy·ªÖn VƒÉn A">
                        </div>
                        <div class="col-12">
                            <label class="form-label">S·ªë ƒëi·ªán tho·∫°i *</label>
                            <input class="form-control" name="phone" required placeholder="09xxxxxxxx">
                        </div>

                        <div class="col-12 d-grid">
                            <button class="btn btn-primary btn-soft">G·ª≠i y√™u c·∫ßu</button>
                        </div>
                    </form>

                    <hr class="my-3">

                    <div class="small text-muted">
                        (B∆∞·ªõc sau) M√¨nh s·∫Ω l√†m b·∫£ng <b>booking_requests</b> + trang Admin duy·ªát ƒë·ªÉ l∆∞u y√™u c·∫ßu n√†y.
                    </div>
                </div>
            </div>

            <div class="card border-0 shadow-sm cardX mt-3">
                <div class="card-body">
                    <h6 class="mb-2">C·∫ßn h·ªó tr·ª£ nhanh?</h6>
                    <div class="text-muted small mb-2">B·∫•m n√∫t ‚Äúü§ñ H·ªó tr·ª£‚Äù ho·∫∑c n√∫t chat g√≥c ph·∫£i.</div>
                    <div class="small">
                        G·ª£i √Ω: <span class="badge text-bg-light">ti·ªÅn c·ªçc</span>
                        <span class="badge text-bg-light">th·ªß t·ª•c thu√™</span>
                        <span class="badge text-bg-light">khi n√†o v√†o ·ªü</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chat widget -->
<div class="chat-panel" id="chatPanel" aria-hidden="true">
    <div class="chat-header">
        <div class="fw-semibold">ü§ñ Tr·ª£ l√Ω Ph√≤ngt·ªët</div>
        <button class="btn btn-sm btn-outline-light" type="button" id="chatClose">ƒê√≥ng</button>
    </div>
    <div class="chat-body" id="chatBody">
        <div class="chat-msg chat-bot">
            Ch√†o b·∫°n üëã B·∫°n ƒëang xem ph√≤ng
            <b th:text="${room.roomCode != null ? room.roomCode : ('#' + room.id)}"></b>.
            B·∫°n mu·ªën h·ªèi v·ªÅ <b>gi√°</b>, <b>c·ªçc</b> hay <b>th·ªß t·ª•c thu√™</b>?
        </div>
    </div>
    <div class="chat-foot">
        <input class="form-control form-control-sm" id="chatInput" placeholder="Nh·∫≠p tin nh·∫Øn..." />
        <button class="btn btn-primary btn-sm" id="chatSend">G·ª≠i</button>
    </div>
</div>

<div class="chat-fab">
    <button class="chat-btn" type="button" id="chatToggle" title="H·ªó tr·ª£">üí¨</button>
</div>

<script>
    (function(){
        const panel = document.getElementById('chatPanel');
        const toggle = document.getElementById('chatToggle');
        const openTop = document.getElementById('chatOpenTop');
        const closeBtn = document.getElementById('chatClose');
        const body = document.getElementById('chatBody');
        const input = document.getElementById('chatInput');
        const send = document.getElementById('chatSend');

        const open = () => { panel.style.display='block'; panel.setAttribute('aria-hidden','false'); input.focus(); };
        const close = () => { panel.style.display='none'; panel.setAttribute('aria-hidden','true'); };

        toggle.addEventListener('click', () => panel.style.display === 'block' ? close() : open());
        if (openTop) openTop.addEventListener('click', open);
        closeBtn.addEventListener('click', close);

        const addMsg = (text, who) => {
            const div = document.createElement('div');
            div.className = 'chat-msg ' + (who === 'user' ? 'chat-user' : 'chat-bot');
            div.innerHTML = text;
            body.appendChild(div);
            body.scrollTop = body.scrollHeight;
        };

        const botReply = (q) => {
            const s = (q || '').toLowerCase();
            if (s.includes('c·ªçc') || s.includes('ti·ªÅn c·ªçc')) return 'Ti·ªÅn c·ªçc th∆∞·ªùng theo ph√≤ng. B·∫°n xem m·ª•c <b>Ti·ªÅn c·ªçc d·ª± ki·∫øn</b> nh√©.';
            if (s.includes('gi√°') || s.includes('bao nhi√™u')) return 'Gi√° thu√™/th√°ng hi·ªÉn th·ªã ·ªü ƒë·∫ßu trang. G·ª≠i y√™u c·∫ßu ƒë·ªÉ admin x√°c nh·∫≠n l·∫°i l·∫ßn n·ªØa.';
            if (s.includes('th·ªß t·ª•c') || s.includes('gi·∫•y t·ªù')) return 'Th∆∞·ªùng c·∫ßn CCCD + ƒë·∫∑t c·ªçc. Admin s·∫Ω h·∫πn l·ªãch xem ph√≤ng/k√Ω h·ª£p ƒë·ªìng sau khi b·∫°n g·ª≠i y√™u c·∫ßu.';
            if (s.includes('khi n√†o') || s.includes('v√†o ·ªü') || s.includes('d·ªçn')) return 'B·∫°n c√≥ th·ªÉ ƒë·ªÅ xu·∫•t th·ªùi gian d·ªçn v√†o khi admin li√™n h·ªá. Tr∆∞·ªõc m·∫Øt b·∫°n c·ª© g·ª≠i y√™u c·∫ßu thu√™ nh√©.';
            return 'B·∫°n mu·ªën h·ªèi v·ªÅ <b>gi√°</b>, <b>c·ªçc</b>, hay <b>th·ªß t·ª•c thu√™</b>?';
        };

        const onSend = () => {
            const text = input.value.trim();
            if (!text) return;
            addMsg(text, 'user');
            input.value = '';
            setTimeout(() => addMsg(botReply(text), 'bot'), 250);
        };

        send.addEventListener('click', onSend);
        input.addEventListener('keydown', (e) => { if (e.key === 'Enter') onSend(); });
    })();
</script>

</body>
</html>
